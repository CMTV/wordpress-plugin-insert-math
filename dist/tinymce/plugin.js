"use strict";tinymce.PluginManager.add("math_plugin",function(t){function e(){jQuery(window).width()<=s.width()&&s.dialog("option","width",jQuery(window).width())}function i(){s.dialog("option","position",{my:"center",at:"center",of:window})}function a(){c.trigger("input")}function n(){s.addClass("_to-insert"),s.dialog("close")}function l(){return r.hasClass("math_plugin-checked")?"block":"inline"}function o(){s.removeClass("_to-insert"),h.removeClass("math_plugin-checked"),r.addClass("math_plugin-checked"),c.val("")}var s=jQuery("#math_plugin-insert-math-dialog"),u="\\displaystyle",d=void 0,c=s.find("#math_plugin-expression"),h=s.find(".math_plugin-display-button"),r=s.find(".math_plugin-display-value-block"),p=s.find(".math_plugin-display-value-inline"),m=s.find(".math_plugin-insert-button");s.dialog({autoOpen:!1,modal:!0,dialogClass:"math_plugin-insert-math-dialog",draggable:!1,width:"auto",height:"auto",open:function(){e(),jQuery(".ui-widget-overlay").bind("click",function(){s.dialog("close")}).css({background:"#000",opacity:"0.7"}),c.focus(),i()},close:function(){var e=void 0,i=void 0;"block"===l()?(e='<p class="math">\\[',i="\\]</p>"):(e='<span class="math">\\(',i="\\)</span>",jQuery(d).hasClass("math")||(e="&#8203;"+e,i+="&#8203;"));var n=c.val().trim();n&&s.hasClass("_to-insert")&&(jQuery(d).hasClass("math")&&d.remove(),t.insertContent(e+" "+n+" "+i)),o(),a()}}),jQuery(window).resize(function(){e(),i()}),h.click(function(){"block"===l()?(h.removeClass("math_plugin-checked"),u="\\textstyle",p.addClass("math_plugin-checked")):(h.removeClass("math_plugin-checked"),u="\\displaystyle",r.addClass("math_plugin-checked")),a()});var g=void 0;c.on("input",function(){clearTimeout(g);var t=c.val().trim();t?g=setTimeout(function(){s.find(".math_plugin-empty").hide(),MathJax.Hub.queue.Push(["Text",MathJax.Hub.getAllJax("math_plugin-preview")[0],u+"{"+t+"}"],function(){s.find(".math_plugin-preview-math").show(),i()})},300):(c.val(""),s.find(".math_plugin-empty").show(),s.find(".math_plugin-preview-math").hide())}),m.click(function(){n()}),s.keypress(function(t){t.keyCode===jQuery.ui.keyCode.ENTER&&n()}),t.addButton("math_plugin-insert-math-button",{image:MATH_PLUGIN_CONSTANTS_719342.BUTTON_ICON_URL,tooltip:MATH_PLUGIN_CONSTANTS_719342.BUTTON_TOOLTIP,stateSelector:".math",onclick:function(){d=t.selection.getNode(),jQuery(d).hasClass("math")&&("P"!==d.tagName&&(h.removeClass("math_plugin-checked"),p.addClass("math_plugin-checked"),u="\\textstyle"),c.val(jQuery(d).html().replace("\\[ ","").replace(" \\]","").replace("\\( ","").replace(" \\)","")),a()),s.dialog("open")}})});