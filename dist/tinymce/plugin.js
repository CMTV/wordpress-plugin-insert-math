"use strict";tinymce.PluginManager.add("math_plugin",function(t){function e(){jQuery(window).width()<=u.width()&&u.dialog("option","width",jQuery(window).width())}function i(){u.dialog("option","position",{my:"center",at:"center",of:window})}function a(){u.addClass("_to-insert"),u.dialog("close")}function n(){return p.hasClass("math_plugin-checked")?"block":"inline"}function l(){return v.hasClass("math_plugin-checked")?"default":y.text()}function o(t){return"#"+t.substr(4,t.indexOf(")")-4).split(",").map(function(t){return parseInt(t).toString(16)}).join("")}function s(){u.removeClass("_to-insert"),d="\\displaystyle",g.removeClass("math_plugin-checked"),p.addClass("math_plugin-checked"),j.find(".math_plugin-header").hasClass("_showing")&&c(),_.removeClass("math_plugin-checked"),v.addClass("math_plugin-checked"),y.css("color","#333333").text("#333333"),C.val(""),k.val(""),m.val("")}function c(){j.find(".math_plugin-header").toggleClass("_showing"),j.find(".math_plugin-additional-settings").toggleClass("_showing").finish().slideToggle(250)}function r(){var t=m.val().trim();t?(u.find(".math_plugin-empty").hide(),MathJax.Hub.queue.Push(["Text",MathJax.Hub.getAllJax("math_plugin-preview")[0],d+"{"+t+"}"],function(){var t=l();"default"!==t?u.find(".math_plugin-preview-math").css("color",t):u.find(".math_plugin-preview-math").css("color",""),u.find(".math_plugin-preview-math").show(),i()})):(m.val(""),u.find(".math_plugin-empty").show(),u.find(".math_plugin-preview-math").hide())}var u=jQuery("#math_plugin-insert-math-dialog"),d="\\displaystyle",h=void 0,m=u.find("#math_plugin-expression"),g=u.find(".math_plugin-display-button"),p=u.find(".math_plugin-display-value-block"),f=u.find(".math_plugin-display-value-inline"),_=u.find(".math_plugin-color-button"),v=u.find(".math_plugin-color-default"),y=u.find(".math_plugin-color-custom"),C=u.find("#math_plugin-formula-id"),k=u.find("#math_plugin-formula-classes"),w=u.find(".math_plugin-insert-button"),j=u.find(".math_plugin-additional-settings-container");u.dialog({autoOpen:!1,modal:!0,dialogClass:"math_plugin-insert-math-dialog",draggable:!1,width:"auto",height:"auto",open:function(){e(),jQuery(".ui-widget-overlay").bind("click",function(){u.dialog("close")}).css({background:"#000",opacity:"0.7"}),m.focus(),i()},close:function(){var e=void 0,i=void 0,a="",o=l();"default"===o&&(a="inherit-color",o="");var c=C.val().trim();c=c?'id="'+c+'"':"";var d=k.val().trim();d||(d=""),"block"===n()?(e='<p class="math block-math '+a+" "+d+'" '+c+' style="color: '+o+';">\\[',i="\\]</p>"):(e='<span class="math block-math '+a+" "+d+'" '+c+' style="color: '+o+'">\\(',i="\\)</span>",jQuery(h).hasClass("math")||(e="&#8203;"+e,i+="&#8203;"));var g=m.val().trim();g&&u.hasClass("_to-insert")&&(jQuery(h).hasClass("math")&&h.remove(),t.insertContent(e+" "+g+" "+i)),s(),r()}}),jQuery(window).resize(function(){e(),i()}),g.click(function(t){t.target===p.get(0)?(g.removeClass("math_plugin-checked"),d="\\displaystyle",p.addClass("math_plugin-checked")):(g.removeClass("math_plugin-checked"),d="\\textstyle",f.addClass("math_plugin-checked")),r()});var Q=void 0;m.on("input",function(){clearTimeout(Q),m.val().trim()?Q=setTimeout(function(){u.find(".math_plugin-empty").hide(),r()},300):(m.val(""),u.find(".math_plugin-empty").show(),u.find(".math_plugin-preview-math").hide())}),w.click(function(){a()}),u.keypress(function(t){t.keyCode===jQuery.ui.keyCode.ENTER&&a()}),j.find(".math_plugin-header").click(function(){c()}),j.find(".math_plugin-default-color-container").iris({palettes:["#C02E1D","#F16C20","#EBC844","#A2B86C","#1395BA","#0D3C55"],change:function(t,e){y.css("color",e.color.toString()).text(e.color.toString())}}),_.click(function(t){t.target===v.get(0)?(_.removeClass("math_plugin-checked"),v.addClass("math_plugin-checked")):(_.removeClass("math_plugin-checked"),y.addClass("math_plugin-checked"),j.find(".math_plugin-default-color-container").iris("show"),T++),r()});var T=0;u.click(function(t){t.target===y.get(0)&&T>1&&(j.find(".math_plugin-default-color-container").iris("hide"),r(),T=0),!jQuery(t.target).closest(".iris-picker").length>0&&t.target!==y.get(0)&&(j.find(".math_plugin-default-color-container").iris("hide"),r(),T=0)}),t.addButton("math_plugin-insert-math-button",{image:MATH_PLUGIN_CONSTANTS_719342.BUTTON_ICON_URL,tooltip:MATH_PLUGIN_CONSTANTS_719342.BUTTON_TOOLTIP,stateSelector:".math",onclick:function(){if(h=t.selection.getNode(),jQuery(h).hasClass("math")){if("P"!==h.tagName&&(g.removeClass("math_plugin-checked"),f.addClass("math_plugin-checked"),d="\\textstyle"),m.val(jQuery(h).html().replace("\\[ ","").replace(" \\]","").replace("\\( ","").replace(" \\)","")),!jQuery(h).hasClass("inherit-color")){var e=o(jQuery(h).css("color"));y.text(e).css("color",e),_.removeClass("math_plugin-checked"),y.addClass("math_plugin-checked")}k.val(void 0===jQuery(h).attr("class")?"":jQuery(h).attr("class").replace("math","").replace("block-math","").replace("inline-math","").replace("inherit-color","").replace("_focus","").trim()),C.val(void 0===jQuery(h).attr("id")?"":jQuery(h).attr("id").trim()),r()}u.dialog("open")}});var b=void 0;t.on("NodeChange",function(t){jQuery(t.element).hasClass("math")&&jQuery(t.element).addClass("_focus"),t.element!==b&&jQuery(b).removeClass("_focus"),b=t.element})});